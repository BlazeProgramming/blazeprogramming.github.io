<!DOCTYPE HTML>
<html>
  <head>
    <title>p5 Live Editor</title>
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,300,400,700" rel="stylesheet">
    <script src="https://cdn.rawgit.com/ajaxorg/ace-builds/master/src-noconflict/ace.js" type="text/javascript"></script>
    <style>
      html{
        overflow: hidden;
      }
      header, #title{
        font-family: Nunito, sans-serif;
      }
      header{
        font-weight: 100;
        font-size: 35px;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 1.5em;
background: linear-gradient(to right, rgba(0,0,0,0.15) 0%,rgba(0,0,0,0) 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#26000000', endColorstr='#00000000',GradientType=1 ); /* IE6-9 */
        padding: 0.5em;
        border-bottom: 2px solid grey;
      }
      #title{
        font-size: 10px;
        position: absolute;
        top: 55px;
        left: 35px;
      }
      #editor {
        position: absolute;
        top: 90px;
        left: 0;
        width: 50%;
        height: calc(100% - 90px);
      }
      iframe#live{
        border: none;
        position:absolute;
        top: 90px;
        left: 50%;
        width: 50%;
        height: calc(100% - 90px);
        border-left: 2px solid grey;
      }
    </style>
  </head>
  <body>
    <header><strong>p5</strong>.live</header>
    <div id="title">implementation by cosigncosine</div>
    <div id="editor">//type here</div>
    <iframe id="live"></iframe>
    <script>
      var editor = ace.edit("editor");
      editor.setTheme("ace/theme/sqlserver");
      editor.session.setMode("ace/mode/javascript");
      editor.setOptions({
        fontFamily: "monospace",
        fontSize: "10px"
      });
      var oldValue = editor.getValue();

<<<<<<< HEAD
      function debounce(func, wait, immediate) {
      	var timeout;
      	return function() {
      		var context = this, args = arguments;
      		var later = function() {
      			timeout = null;
      			if (!immediate) func.apply(context, args);
      		};
      		var callNow = immediate && !timeout;
      		clearTimeout(timeout);
      		timeout = setTimeout(later, wait);
      		if (callNow) func.apply(context, args);
      	};
      };
      document.addEventListener("keyup", debounce(fini, 500, false));
=======
      // https://stackoverflow.com/questions/4220126/run-javascript-function-when-user-finishes-typing-instead-of-on-key-up
      //setup before functions
      var typingTimer;                //timer identifier
      var doneTypingInterval = 400;  //time in ms

      document.addEventListener("keyup", function(){
          clearTimeout(typingTimer);
          typingTimer = setTimeout(doneTyping, doneTypingInterval);
      });
>>>>>>> 2e8a095ae3de37528dc0e9cff31c85c4b0202f00

      function canvasAlert(){
        document.write('hi')
      }
<<<<<<< HEAD
      function fini () {
=======
      function doneTyping () {
>>>>>>> 2e8a095ae3de37528dc0e9cff31c85c4b0202f00
        if(oldValue !== editor.getValue()){
          var output = "<!DOCTYPE HTML><html><head><title>easter egg<\/title><script src=\"https:\/\/cdnjs.cloudflare.com\/ajax\/libs\/p5.js\/0.6.1/p5.js\"><\/script></head><body><div id=\"holder\" style=\"position: fixed; top: 0; left: 0; height: 100%; width: 100;\"></div><script type=\"text/javascript\">try{function setup() {var canvas = createCanvas(windowWidth, windowHeight);canvas.parent('holder');background(255, 0, 200);" + editor.getValue() + '};function windowResized() {resizeCanvas(windowWidth, windowHeight);};}catch(e){console.log(e)}<\/script><\/body><\/head>';
          document.getElementById("live").srcdoc = output;
          oldValue = editor.getValue();
          document.getElementById("live").contentWindow.onerror = document.getElementById("live").contentWindow.onError = function() {
            alert('error!!');
            return false;
          };
        }
      }


    </script>
  </body>
</html>
